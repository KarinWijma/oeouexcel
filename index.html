<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Spelling Oefenspel oe of ou</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        #wordDisplay { font-size: 40px; margin: 20px; }
        .highlight { color: red; font-weight: bold; }
        button { font-size: 20px; margin: 10px; padding: 10px 20px; }
        #hint { color: blue; font-size: 18px; margin: 10px; }
        #foutLijst { margin-top: 30px; font-size: 18px; }
    </style>
</head>
<body>
    <h1>Spelling Oefenspel: oe of ou</h1>
    <input type="file" id="fileInput" accept=".xlsx" />
    <div id="hint"></div>
    <div id="wordDisplay"></div>
    <div>
        <button onclick="checkAnswer('oe')">oe</button>
        <button onclick="checkAnswer('ou')">ou</button>
    </div>
    <div id="foutLijst"></div>

    <script>
        let woordenlijst = [];
        let todo = [];
        let fouten = [];
        let huidig = null;
        let index = -1;
        let correct = "";

        document.getElementById('fileInput').addEventListener('change', handleFile, false);

        function handleFile(e) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const json = XLSX.utils.sheet_to_json(sheet);
                woordenlijst = json.filter(r => r.woord && (r.woord.includes("oe") || r.woord.includes("ou")));
                todo = [...woordenlijst];
                shuffle(todo);
                volgendeWoord();
            };
            reader.readAsArrayBuffer(e.target.files[0]);
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function volgendeWoord() {
            if (todo.length === 0) {
                document.getElementById("hint").textContent = "";
                document.getElementById("wordDisplay").textContent = "ðŸŽ‰ Het spel is klaar!";
                toonFouten();
                return;
            }
            huidig = todo.shift();
            const woord = huidig.woord;
            index = woord.indexOf("oe");
            correct = "oe";
            if (index === -1) {
                index = woord.indexOf("ou");
                correct = "ou";
            }
            const gemaskeerd = woord.substring(0, index) + "__" + woord.substring(index + 2);
            document.getElementById("wordDisplay").innerHTML = gemaskeerd;
            document.getElementById("hint").textContent = huidig.commentaar || "";
        }

        function checkAnswer(keuze) {
            const woord = huidig.woord;
            if (keuze === correct) {
                document.getElementById("wordDisplay").textContent = woord;
            } else {
                const gemarkeerd = woord.substring(0, index) +
                    "<span class='highlight'>" + correct + "</span>" +
                    woord.substring(index + 2);
                document.getElementById("wordDisplay").innerHTML = gemarkeerd;
                if (!todo.some(w => w.woord === woord)) {
                    todo.push(huidig);
                }
                if (!fouten.some(w => w.woord === woord)) {
                    fouten.push(huidig);
                }
            }
            setTimeout(volgendeWoord, 1500);
        }

        function toonFouten() {
            if (fouten.length === 0) return;
            const foutDiv = document.getElementById("foutLijst");
            foutDiv.innerHTML = "<h3>Fout beantwoorde woorden:</h3><ul>" +
                fouten.map(f => "<li>" + f.woord + "</li>").join("") + "</ul>";
        }
    </script>
</body>
</html>